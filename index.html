<button id="btn">АКТИВИРОВАТЬ</button>
<audio id="sound" src="Svinya .mp3" preload="auto"></audio>

<script>
const API_KEY = "$2a$10$1RugbNNDNYauNVoP/ToX/OoVoTR9s8PzxazU8UWpsKu46Gfab3o0O";
const BIN_ID = "6989f83fae596e708f1dc49a";

const btn = document.getElementById("btn");
const audio = document.getElementById("sound");

let armed = false;

// 1️⃣ Кнопка ТОЛЬКО разрешает возможное воспроизведение
btn.onclick = async () => {
  armed = true;
  btn.classList.add("active"); // анимация
};

// 2️⃣ Отдельная функция проверки
async function checkFlag() {
  if (!armed) return;

  const res = await fetch(
    `https://api.jsonbin.io/v3/b/${BIN_ID}/latest`,
    {
      headers: {
        "X-Master-Key": API_KEY
      },
      cache: "no-store" // ❗ убираем кэш
    }
  );

  const data = await res.json();

  if (data.record.allowed === true) {
    audio.currentTime = 0;
    audio.play();

    armed = false; // ❗ сброс
  }
}

// 3️⃣ Проверяем раз в 1 секунду
setInterval(checkFlag, 1000);
</script>
